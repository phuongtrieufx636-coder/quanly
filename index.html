<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>🐱 Game Nuôi Mèo (HTML)</title>
  <style>
    :root{
      --bg:#f7f7fb; --panel:#ffffff; --text:#0f172a; --muted:#64748b; --accent:#8b5cf6; --accent2:#22c55e; --warn:#f59e0b; --danger:#ef4444;
      --shadow:0 6px 20px rgba(2,6,23,.08);
    }
    *{box-sizing:border-box} html,body{height:100%}
    body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Arial; color:var(--text); background:var(--bg);}    
    .wrap{max-width:1000px;margin:0 auto;padding:18px}
    .header{display:flex;align-items:center;gap:12px;flex-wrap:wrap}
    .title{font-weight:800;font-size:clamp(20px,3vw,28px)}
    .card{background:var(--panel);border:1px solid #e5e7eb;border-radius:16px; box-shadow:var(--shadow)}
    .hud{display:grid; grid-template-columns: 1.2fr .8fr; gap:14px;}
    @media (max-width:880px){ .hud{grid-template-columns:1fr} }
    .arena{position:relative; height:min(56vh,480px); min-height:360px; overflow:hidden; border-radius:16px;}
    .sky{position:absolute; inset:0; background:linear-gradient(180deg,#e8f0ff 0%, #fefefe 70%)}
    .floor{position:absolute; left:0; right:0; bottom:0; height:36%; background:linear-gradient(180deg,#e9f8ee 0%, #c7f8db 100%); border-top:1px dashed #bde7cb}
    .cat{position:absolute; left:50%; top:45%; translate:-50% -50%; font-size:60px; filter:drop-shadow(0 8px 16px rgba(0,0,0,.2)); transition: transform .25s}
    .cat.walk{animation:walk .8s steps(2) infinite}
    .cat.sleep{filter:grayscale(.15) brightness(.95)}
    @keyframes walk{ 0%{transform:translateY(-2px)} 50%{transform:translateY(0)} 100%{transform:translateY(-2px)} }
    .bubble{position:absolute; translate:-50% -110%; background:#fff; border:1px solid #e5e7eb; padding:6px 10px; border-radius:999px; font-size:14px; color:#374151; box-shadow:var(--shadow)}
    .obj{position:absolute; font-size:42px; filter:drop-shadow(0 6px 10px rgba(0,0,0,.15))}

    .sidebar{padding:14px}
    .bars{display:grid; gap:10px}
    .bar{display:flex; align-items:center; gap:8px}
    .bar .name{width:110px; font-size:13px; color:var(--muted);}
    progress{width:100%; height:12px; appearance:none}
    progress::-webkit-progress-bar{background:#eef2ff; border-radius:8px}
    progress::-webkit-progress-value{background:linear-gradient(90deg,var(--accent),#06b6d4); border-radius:8px}
    .bar.clean progress::-webkit-progress-value{background:linear-gradient(90deg,#06b6d4,#60a5fa)}
    .bar.energy progress::-webkit-progress-value{background:linear-gradient(90deg,#f59e0b,#f97316)}
    .bar.hunger progress::-webkit-progress-value{background:linear-gradient(90deg,#ef4444,#f97316)}

    .actions{display:grid; grid-template-columns: repeat(4,1fr); gap:10px; margin-top:12px}
    @media(max-width:560px){ .actions{grid-template-columns: repeat(2,1fr)} }
    .btn{padding:10px 12px; border-radius:12px; border:1px solid #e5e7eb; background:#fff; cursor:pointer; font-weight:700; display:flex; align-items:center; gap:8px; justify-content:center}
    .btn:hover{box-shadow:var(--shadow)}
    .btn:active{transform:translateY(1px)}
    .btn.primary{background:linear-gradient(180deg,#f7f7ff,#fff)}

    .log{padding:10px; height:120px; overflow:auto; border:1px dashed #e5e7eb; border-radius:12px; background:#fcfcff}
    .row{display:flex; gap:10px; align-items:center; flex-wrap:wrap}
    .small{font-size:12px; color:var(--muted)}
    .toggle{display:inline-flex; gap:8px; align-items:center}
    .toggle input{scale:1.1}
    .footer{margin-top:10px; font-size:12px; color:var(--muted)}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="header">
      <div class="title">🐾 Game Nuôi Mèo</div>
      <div class="small">Chạm/nhấn trong sân để mèo chạy tới!</div>
    </div>

    <div class="hud">
      <!-- KHU VỰC CHƠI -->
      <div class="card arena" id="arena" aria-label="Khu chơi của mèo">
        <div class="sky"></div>
        <div class="floor"></div>
        <div class="cat" id="cat" role="img" aria-label="Mèo">🐈</div>
        <div class="bubble" id="bubble" style="left:50%; top:45%">Xin chào! 😺</div>
        <!-- Đồ vật xuất hiện khi hành động -->
        <div class="obj" id="bowl" hidden>🍲</div>
        <div class="obj" id="toy" hidden>🧶</div>
        <div class="obj" id="bed" hidden>🛏️</div>
        <div class="obj" id="bath" hidden>🛁</div>
      </div>

      <!-- BẢNG ĐIỀU KHIỂN -->
      <div class="card sidebar">
        <div class="row">
          <div class="small">Tên mèo:</div>
          <input id="name" placeholder="Đặt tên..." style="padding:8px;border:1px solid #e5e7eb;border-radius:10px;width:160px"/>
          <button class="btn" id="btnRandom">🎲 Ngẫu nhiên</button>
        </div>
        <div class="bars" style="margin-top:10px">
          <div class="bar hunger"><div class="name">Đói (0 tốt)</div><progress id="hunger" value="30" max="100"></progress></div>
          <div class="bar energy"><div class="name">Năng lượng</div><progress id="energy" value="70" max="100"></progress></div>
          <div class="bar"><div class="name">Vui vẻ</div><progress id="happy" value="60" max="100"></progress></div>
          <div class="bar clean"><div class="name">Sạch sẽ</div><progress id="clean" value="80" max="100"></progress></div>
        </div>

        <div class="actions">
          <button class="btn primary" id="actFeed">🍗 Cho ăn</button>
          <button class="btn primary" id="actPlay">🧶 Chơi</button>
          <button class="btn primary" id="actSleep">🛏️ Ngủ</button>
          <button class="btn primary" id="actBath">🛁 Tắm</button>
        </div>

        <div class="row" style="margin-top:8px">
          <label class="toggle"><input type="checkbox" id="sound"/> 🔊 Âm thanh</label>
          <button class="btn" id="actSave">💾 Lưu</button>
          <button class="btn" id="actReset">♻️ Reset</button>
        </div>

        <div class="log" id="log" aria-live="polite"></div>
        <div class="footer">Mẹo: giữ các chỉ số ở mức 40–90 là lý tưởng. Nếu Đói > 90, mèo sẽ cáu kỉnh! 😿</div>
      </div>
    </div>
  </div>

  <script>
    // ====== TRẠNG THÁI ======
    const S = {
      name: 'Mèo Con',
      hunger: 30, // 0 tốt, 100 rất đói
      energy: 70,
      happy: 60,
      clean: 80,
    };

    const els = {
      arena: document.getElementById('arena'),
      cat: document.getElementById('cat'),
      bubble: document.getElementById('bubble'),
      bowl: document.getElementById('bowl'),
      toy: document.getElementById('toy'),
      bed: document.getElementById('bed'),
      bath: document.getElementById('bath'),
      hunger: document.getElementById('hunger'),
      energy: document.getElementById('energy'),
      happy: document.getElementById('happy'),
      clean: document.getElementById('clean'),
      name: document.getElementById('name'),
      log: document.getElementById('log'),
      sound: document.getElementById('sound'),
    };

    const RNG_NAMES = ['Miu','Mun','Bông','Xoài','Mướp','Mít','Đậu','Bé Mèo','Kem','Sữa'];

    let moving = false; let tickTimer; let roamTimer; let moodTimer; let lastActionAt = 0;

    // ====== ÂM THANH (WebAudio beep nhỏ) ======
    let audioCtx = null;
    function beep(freq=660, dur=120){
      if(!els.sound.checked) return;
      audioCtx = audioCtx || new (window.AudioContext||window.webkitAudioContext)();
      const o = audioCtx.createOscillator(); const g = audioCtx.createGain();
      o.connect(g); g.connect(audioCtx.destination); o.frequency.value=freq; o.type='sine';
      g.gain.setValueAtTime(0.04, audioCtx.currentTime); g.gain.exponentialRampToValueAtTime(0.0001, audioCtx.currentTime+dur/1000);
      o.start(); setTimeout(()=>o.stop(), dur);
    }

    // ====== TIỆN ÍCH ======
    function clamp(v,min=0,max=100){ return Math.max(min, Math.min(max,v)); }
    function uiSync(){
      els.hunger.value = S.hunger; els.energy.value=S.energy; els.happy.value=S.happy; els.clean.value=S.clean;
      els.name.value = S.name;
    }
    function speak(text){ els.bubble.textContent = text; }
    function log(msg){ const t = new Date().toLocaleTimeString(); els.log.innerHTML = `<div>[${t}] ${msg}</div>` + els.log.innerHTML; }
    function save(){ localStorage.setItem('catSave', JSON.stringify(S)); log('Đã lưu tiến độ. 💾'); beep(880,80); }
    function load(){ const raw = localStorage.getItem('catSave'); if(!raw) return; try{ const d=JSON.parse(raw); Object.assign(S,d); }catch{} }

    // ====== DI CHUYỂN ======
    function moveCatTo(x,y, speed=240){
      const rect = els.arena.getBoundingClientRect();
      x = clamp(x, 40, rect.width-40); y = clamp(y, 80, rect.height-50);
      const cat = els.cat;
      const cur = cat.getBoundingClientRect();
      const dx = x - (cur.left - rect.left + cur.width/2);
      const dy = y - (cur.top - rect.top + cur.height/2);
      const dist = Math.hypot(dx,dy);
      const ms = Math.max(120, Math.min(1200, (dist/ speed)*1000));
      cat.style.transition = `left ${ms}ms linear, top ${ms}ms linear`;
      cat.classList.add('walk');
      cat.style.left = x + 'px';
      cat.style.top  = y + 'px';
      moving = true;
      return new Promise(res=> setTimeout(()=>{ cat.classList.remove('walk'); moving=false; res(); }, ms+20));
    }

    function randomRoam(){
      const r = els.arena.getBoundingClientRect();
      const x = 60 + Math.random()*(r.width-120);
      const y = 120 + Math.random()*(r.height-180);
      moveCatTo(x,y, 180);
    }

    // ====== HÀNH ĐỘNG ======
    async function actFeed(){
      lastActionAt = Date.now();
      showObj(els.bowl);
      const p = posOf(els.bowl);
      await moveCatTo(p.x, p.y-10);
      speak('Ngon quá! 😻'); beep(720,100);
      S.hunger = clamp(S.hunger - 28); S.happy = clamp(S.happy + 6); S.energy = clamp(S.energy + 4);
      uiSync(); log('Bạn đã cho ăn. Đói giảm mạnh.');
      hideObj(els.bowl, 900);
    }

    async function actPlay(){
      lastActionAt = Date.now();
      showObj(els.toy);
      const p = posOf(els.toy);
      await moveCatTo(p.x, p.y-6);
      speak('Chơi nào! 🐾'); beep(880,100);
      S.happy = clamp(S.happy + 16); S.energy = clamp(S.energy - 8); S.hunger = clamp(S.hunger + 6);
      uiSync(); log('Bạn đã chơi cùng mèo. Vui vẻ tăng.');
      hideObj(els.toy, 1100);
    }

    async function actSleep(){
      lastActionAt = Date.now();
      showObj(els.bed);
      const p = posOf(els.bed);
      await moveCatTo(p.x+6, p.y-10);
      els.cat.classList.add('sleep'); speak('Khò khò... 😴');
      beep(520,80);
      await wait(1400);
      S.energy = clamp(S.energy + 24); S.hunger = clamp(S.hunger + 8); S.clean = clamp(S.clean - 6);
      els.cat.classList.remove('sleep'); uiSync(); log('Mèo đã ngủ một giấc ngắn. Năng lượng tăng.');
      hideObj(els.bed, 600);
    }

    async function actBath(){
      lastActionAt = Date.now();
      showObj(els.bath);
      const p = posOf(els.bath);
      await moveCatTo(p.x, p.y-8);
      speak('Tắm mát! 🛁'); beep(1000,90);
      await wait(900);
      S.clean = clamp(S.clean + 22); S.happy = clamp(S.happy + 4); S.energy = clamp(S.energy - 4);
      uiSync(); log('Tắm xong thơm tho sạch sẽ.');
      hideObj(els.bath, 700);
    }

    function wait(ms){ return new Promise(r=>setTimeout(r,ms)); }

    function posOf(el){ const R = el.getBoundingClientRect(); const A = els.arena.getBoundingClientRect(); return {x: R.left - A.left + R.width/2, y: R.top - A.top + R.height/2}; }
    function showObj(el){
      placeObj(el); el.hidden=false; el.style.opacity='0'; el.style.transition='opacity .25s, transform .25s'; el.style.transform='translateY(6px)';
      requestAnimationFrame(()=>{ el.style.opacity='1'; el.style.transform='translateY(0)'; });
    }
    function hideObj(el, delay=500){ setTimeout(()=>{ el.style.opacity='0'; setTimeout(()=>{ el.hidden=true; }, 250); }, delay); }
    function placeObj(el){ const r = els.arena.getBoundingClientRect(); const x = 60 + Math.random()*(r.width-120); const y = r.height*0.58 + Math.random()* (r.height*0.24); el.style.left=x+'px'; el.style.top=y+'px'; }

    // ====== VÒNG LẶP GAME ======
    function startLoops(){
      clearInterval(tickTimer); clearInterval(roamTimer); clearInterval(moodTimer);
      // Cập nhật chỉ số mỗi 3s
      tickTimer = setInterval(()=>{
        // tự suy giảm & tăng
        S.hunger = clamp(S.hunger + 3);
        S.energy = clamp(S.energy - 2);
        S.happy  = clamp(S.happy - (S.hunger>80? 3:1));
        if(S.clean>0 && Math.random()<0.5) S.clean = clamp(S.clean - 1);
        if(S.hunger>90){ speak('Em đói quá...'); }
        if(S.energy<15){ speak('Buồn ngủ ghê...'); }
        uiSync();
        autoNeeds();
        save();
      }, 3000);

      // Đi dạo ngẫu nhiên
      roamTimer = setInterval(()=>{ if(!moving && Date.now()-lastActionAt>1500) randomRoam(); }, 1600);

      // Bong bóng cảm xúc
      moodTimer = setInterval(()=>{
        const mood = moodText(); if(Math.random()<0.7) speak(mood);
      }, 5000);
    }

    function moodText(){
      if(S.hunger>85) return 'Đói! cho em ăn với...';
      if(S.energy<20) return 'Em cần ngủ xíu...';
      if(S.clean<35) return 'Em muốn tắm ~';
      if(S.happy>75) return 'Tuyệt vời! ❤';
      if(S.happy<35) return 'Hơi buồn... chơi cùng em nhé?';
      return 'Meow~ meow~';
    }

    // Nhu cầu tự động nếu quá tệ
    function autoNeeds(){
      if(S.hunger>95) { log('⚠️ Mèo quá đói! Mất thêm vui.'); S.happy = clamp(S.happy-6); }
      if(S.energy<5) { log('⚠️ Mèo kiệt sức, bắt buộc ngủ ngắn.'); actSleep(); }
    }

    // ====== SỰ KIỆN UI ======
    document.getElementById('actFeed').onclick = actFeed;
    document.getElementById('actPlay').onclick = actPlay;
    document.getElementById('actSleep').onclick = actSleep;
    document.getElementById('actBath').onclick = actBath;
    document.getElementById('actSave').onclick = save;
    document.getElementById('actReset').onclick = ()=>{ localStorage.removeItem('catSave'); location.reload(); };
    document.getElementById('btnRandom').onclick = ()=>{ S.name = RNG_NAMES[Math.floor(Math.random()*RNG_NAMES.length)]; uiSync(); log('Đổi tên mèo thành: '+S.name); };
    els.name.addEventListener('change', ()=>{ S.name = els.name.value.trim()||'Mèo Con'; save(); });

    // chạm / click để mèo chạy tới
    els.arena.addEventListener('pointerdown', (e)=>{
      const r = els.arena.getBoundingClientRect();
      moveCatTo(e.clientX - r.left, e.clientY - r.top);
      speak('Tới liền! 🐾');
    });

    // ====== KHỞI TẠO ======
    load();
    uiSync();
    log('Chào mừng tới Game Nuôi Mèo!');
    startLoops();
  </script>
</body>
</html>
